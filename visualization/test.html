<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>echarts示例</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
  </style>
  <!-- 引入echarts库 -->
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.1.2/dist/echarts.min.js"></script>
</head>
<body>
<div id="main" style="width: 100%; height: 100%;"></div>

<script>
  var chartDom = document.getElementById('main');
  var myChart = echarts.init(chartDom);
  var option;

  myChart.showLoading();

  // 加载本地数据文件
  fetch('visual1.json')
          .then(function (response) {
            return response.json();
          })
          .then(function (graph) {
            myChart.hideLoading();

            option = {
              tooltip: {
                show: true,
                formatter: function (params) {
                  if (params.dataType === 'edge') {
                    // 边的提示信息
                    var sourceName = params.data.source;
                    var targetName = params.data.target;
                    var edge = graph.links.find(function (link) {
                      return link.source === sourceName && link.target === targetName;
                    });
                    if (edge && edge.relations) {
                      var relations = edge.relations;
                      var label = 'Source: ' + sourceName + '<br>Target: ' + targetName + '<br>Relations: ' + JSON.stringify(relations);
                      return label;
                    }
                  } else if (params.dataType === 'node') {
                    // 节点的提示信息
                    var nodeName = params.data.name;
                    var weight = params.data.symbolSize
                    var label = 'Node: ' + nodeName +  '<br>weight:' + weight;
                    return label;
                  }
                  return ''; // 如果没有相关信息，返回空字符串
                }
              },


              legend: [
                {
                  data: graph.categories.map(function (a) {
                    return a.name;
                  })
                }
              ],
              series: [
                {
                  name: 'Les Miserables',
                  type: 'graph',
                  layout: 'force',
                  data: graph.nodes,
                  // 箭头
                  edgeSymbol: [ 'arrow'],
                  edgeSymbolSize: [4, 10],

                  links: graph.links.map(function (link) {
                    return {
                      source: link.source,
                      target: link.target,
                      value: link.weight,
                      relations: link.Relations,
                      lineStyle: {
                        width: link.value, // 设置边的粗细为权重值
                        type: 'solid' // 设置为实线
                      }
                    };
                  }),


                  categories: graph.categories,
                  roam: true,

                  label: {
                    show: true,
                    position: 'right',
                    formatter: '{b}'
                  },
                  force: {
                    repulsion: 1000, // 节点之间的斥力
                    edgeLength: 300, // 边的长度
                    friction: 0.1
                  },


                  labelLayout: {
                    hideOverlap: true
                  },
                  scaleLimit: {
                    min: 0.4,
                    max: 2
                  },
                  lineStyle: {
                    color: 'source',
                    curveness: 0.1,
                    type: 'solid' // 设置为实线
                  }
                }
              ]
            };
            myChart.setOption(option);
          })
          .catch(function (error) {
            console.error('Failed to load data file:', error);
          });
</script>
</body>
</html>
